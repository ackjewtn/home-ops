---
- name: Apply storage annotations
  command: kubectl label --overwrite node {{ item }} node.longhorn.io/create-default-disk=true
  loop: "{{ groups['k3s_worker'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"

- name: Apply worker annotations
  command: kubectl label --overwrite node {{ item }} node-role.kubernetes.io/worker=true
  loop: "{{ groups['k3s_worker'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"

- name: Apply system-upgrade node annotations
  command: kubectl label --overwrite node {{ item }} k3s-upgrade=true
  loop: "{{ groups['k3s_worker'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"

- name: Apply master taints
  command: kubectl taint --overwrite node {{ item }} node-role.kubernetes.io/master=true:NoSchedule
  loop: "{{ groups['k3s_master'] }}"
  environment:
    KUBECONFIG: "{{ REPO_ROOT }}/kubeconfig"
