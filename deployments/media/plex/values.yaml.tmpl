---
podAnnotations:
  secret.reloader.stakater.com/reload: "tls.plex"

ingress:
  enabled: true
  annotations:
    kubernetes.io/ingress.class: nginx
    external-dns.alpha.kubernetes.io/target: {{ (datasource "cluster-vars").domain.external.primary }}
    external-dns.alpha.kubernetes.io/cloudflare-proxied: "true"
    nginx.ingress.kubernetes.io/backend-protocol: "HTTPS"
    cert-manager.io/cluster-issuer: letsencrypt-production
  hosts:
    - "plex.{{ (datasource "cluster-vars").domain.external.primary }}"
  tls:
    - secretName: tls.plex
      hosts:
        - "plex.{{ (datasource "cluster-vars").domain.external.primary }}"

advertiseIp: "https://plex.{{ (datasource "cluster-vars").domain.external.primary }}"
claimToken: {{ (datasource "plex").claimToken }}

timezone: "Europe/Amsterdam"
plexUid: 1031
plexGid: 100

serviceTCP:
  type: LoadBalancer
  externalIPs:
    - 192.168.26.9
  externalTrafficPolicy: Local

serviceUDP:
  type: LoadBalancer
  externalIPs:
    - 192.168.26.9
  externalTrafficPolicy: Local

persistence:
  config:
    size: 20Gi
    accessMode: ReadWriteOnce

  transcode:
    enabled: false
    emptyDir:
      medium: "Memory"

  data:
    enabled: false

  extraMounts:
    - name: nfs-nas-media
      claimName: nfs-nas-media
      mountPath: /storage/media

certificate:
  pkcsMangler:
    enabled: true
    image:
      repository: tlsprint/openssl
      tag: 1.1.1f
    setPlexPreferences:
      enabled: true
    plexPreferences:
      customCertificateDomain: "plex.{{ (datasource "cluster-vars").domain.external.primary }}"
    certificateSecret:
      name: "tls.plex"

resources:
  requests:
    cpu: 35m
    memory: 1500Mi
  limits:
    gpu.intel.com/i915: 1
    memory: 8000Mi

affinity:
  nodeAffinity:
    requiredDuringSchedulingIgnoredDuringExecution:
      nodeSelectorTerms:
        - matchExpressions:
            - key: feature.node.kubernetes.io/custom-intel-gpu
              operator: In
              values:
                - "true"
